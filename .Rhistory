p + geom_boxplot(aes(x=REGION, y=UGDS_BLACK)) + ylim(0,1) + labs(x="Region", y="Proportion of Enrolled Black Students", title="Distribution of Black Enrollement by Region") + coord_flip()
p + geom_boxplot(aes(x=REGION, y=UGDS_HISP)) + ylim(0,1)  + labs(x="Region", y="Proportion of Enrolled Hispanic Students", title="Distribution of Hispanic Enrollement by Region") + coord_flip()
p + geom_boxplot(aes(x=REGION, y=UGDS_ASIAN)) + ylim(0,1)  + labs(x="Region", y="Proportion of Enrolled Asian Students", title="Distribution of Asian Enrollement by Region") + coord_flip()
#p + geom_boxplot(aes(x=REGION, y=UGDS_AIAN)) + ylim(0,1)  + labs(x="Region", y="Proportion of Enrolled American Indian/Alaska Native", title="Distribution of American Indian/Alaska Native Enrollement by Region") + coord_flip()
#p + geom_boxplot(aes(x=REGION, y=UGDS_AIAN)) + ylim(0,1)  + labs(x="Region", y="Proportion of Enrolled American Indian/Alaska Native", title="Distribution of American Indian/Alaska Native Enrollement by Region") + coord_flip()
#p + geom_boxplot(aes(x=REGION, y=UGDS_NHPI)) + ylim(0,1)  + labs(x="Region", y="Proportion of Enrolled Native Hawaiian/Pacific Islander", title="Distribution of Native Hawaiian/Pacific Islander Enrollement by Region") + coord_flip()
UGDS_BLACK_STATE <- fouryear %>% select(STABBR, UGDS_BLACK) %>% group_by(STABBR) %>% summarise_at(vars(UGDS_BLACK), list(name = mean), na.rm = TRUE)
UGDS_BLACK_STATE$region <- states$full[match(UGDS_BLACK_STATE$STABBR, states$state)]
states_black <- map_data("state")
map.df <- merge(states_black,UGDS_BLACK_STATE, by="region", all.x=T)
map.df <- map.df[order(map.df$order),]
map.df$blackpct <- map.df$name
ggplot(map.df, aes(x=long,y=lat,group=group)) + labs(x="", y="", title="Average Black Undergrad Percentage by State") + geom_polygon(aes(fill=blackpct)) + geom_path() + scale_fill_gradientn(colours=rev(heat.colors(10)),na.value="grey90") + coord_map() + theme_bw() + theme(axis.text.x = element_blank(), axis.ticks.x = element_blank(), axis.text.y = element_blank(), axis.ticks.y = element_blank())
p + geom_point(aes(x = SAT_AVG, y=ADM_RATE, color=CONTROL), alpha=0.7) + labs(x="Average SAT Score",y="Admit Rate", title="SAT Score vs Admit Rate") + geom_smooth(aes(x = SAT_AVG, y=ADM_RATE), method = "lm")
p + geom_point(aes(x=UG25ABV , y=PPTUG_EF, color=CONTROL)) + geom_smooth(aes(x = UG25ABV, y=PPTUG_EF), method = "lm") + labs(x="Percentage of students older than 25 yrs old", y="Percentage of part-time students", title = "Older students and Part Time Students")
p + geom_boxplot(aes(x=reorder(STABBR, COSTT4_A, na.rm = TRUE), y=NPT4))+ labs(x="State", y="Average Net Cost", title="Average Net Cost by State") + coord_flip()
p + geom_boxplot(aes(x=reorder(REGION, COSTT4_A, na.rm = TRUE), y=NPT4)) + labs(x="Region", y="Average Net Cost", title="Average Net Cost by Region") + coord_flip()
p + geom_boxplot(aes(x=reorder(STABBR, NPT4, na.rm = TRUE), y=NPT4))+ labs(x="State", y="Average Net Price", title="Average Net Price by State") + coord_flip()
p + geom_boxplot(aes(x=reorder(REGION, NPT4, na.rm = TRUE), y=NPT4)) + labs(x="Region", y="Average Net Price", title="Average Net Price by Region") + coord_flip()
COSTT4_A_STATE <- fouryear %>% select(STABBR, COSTT4_A) %>% group_by(STABBR) %>% summarise_at(vars(COSTT4_A), list(name = mean), na.rm = TRUE)
COSTT4_A_STATE$region <- states$full[match(COSTT4_A_STATE$STABBR, states$state)]
states_netprice <- map_data("state")
map.df <- merge(states_netprice, COSTT4_A_STATE, by="region", all.x=T)
map.df <- map.df[order(map.df$order),]
map.df$avg_netcost <- map.df$name
ggplot(map.df, aes(x=long,y=lat,group=group)) + labs(x="", y="", title="Average Net Cost by State") + geom_polygon(aes(fill=avg_netcost)) + geom_path() + scale_fill_gradientn(colours=rev(terrain.colors(8)),na.value="grey90") + coord_map() + theme_bw() + theme(axis.text.x = element_blank(), axis.ticks.x = element_blank(), axis.text.y = element_blank(), axis.ticks.y = element_blank())
NPT4_STATE <- fouryear %>% select(STABBR, NPT4) %>% group_by(STABBR) %>% summarise_at(vars(NPT4), list(name = mean), na.rm = TRUE)
NPT4_STATE$region <- states$full[match(NPT4_STATE$STABBR, states$state)]
states_netprice <- map_data("state")
map.df <- merge(states_netprice, NPT4_STATE, by="region", all.x=T)
map.df <- map.df[order(map.df$order),]
map.df$avg_netprice <- map.df$name
ggplot(map.df, aes(x=long,y=lat,group=group)) + labs(x="", y="", title="Average Net Price by State") + geom_polygon(aes(fill=avg_netprice)) + geom_path() + scale_fill_gradientn(colours=rev(terrain.colors(8)),na.value="grey90") + coord_map() + theme_bw() + theme(axis.text.x = element_blank(), axis.ticks.x = element_blank(), axis.text.y = element_blank(), axis.ticks.y = element_blank())
p + geom_point(aes(x =  COSTT4_A, y= NPT4, color=CONTROL), alpha=.4) + labs(x="Average Net Cost",y="Average Net Price", title="Average Net Cost vs Average Net Price")
p + geom_boxplot(aes(x=reorder(STABBR, AVGFACSAL, na.rm = TRUE), y=AVGFACSAL)) + labs(x="State", y="Average Faculty Salary", title="Average Faculty Monthly Salary by State") + coord_flip()
p + geom_boxplot(aes(x=reorder(REGION, AVGFACSAL, na.rm = TRUE), y=AVGFACSAL)) + labs(x="Region", y="Average Faculty Salary", title="Average Faculty Monthly Salary by Region") + coord_flip()
p + geom_point(aes(x = NPT4, y=AVGFACSAL, color=CONTROL), alpha=.4) + labs(x="Average Net Price",y="Average Faculty Monthly Salary", title="Average Net Price vs Average Faculty Monthly Salary ")
p + geom_point(aes(x = COSTT4_A, y=AVGFACSAL, color=CONTROL), alpha=.4) + labs(x="Average Cost of Attendance",y="Average Faculty Monthly Salary", title="Average Cost of Attendance vs Average Faculty Monthly Salary ")
p + geom_boxplot(aes(x=CONTROL, y=COSTT4_A)) + labs(x="Institution Control", y="Average Cost of Attendance", title = "Average Cost of Attendance by Control")
p + geom_boxplot(aes(x=CONTROL, y=NPT4)) + labs(x="Institution Control", y="Average Net Price", title = "Average Net Price by Control")
p + geom_boxplot(aes(x=CONTROL, y=AVGFACSAL)) + labs(x="Institution Control", y="Average Montly Faculty Salary", title = "Average Montly Faculty Salary by Control")
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
library(readr)
library(tidyr)
library(gridExtra)
library(tufte)
library(readxl)
library(dplyr)
library(reshape2)
library(gghighlight)
library(DBI)
library(maps)
library(mapproj)
scorecard <- read_excel("selectedvar_1314.xlsx")
summary(scorecard)
# CLEAN Data: convert to appropriate type, name categorical variables
# Convert to appropriate type
numeric_col_names <- colnames(scorecard[, !names(scorecard) %in% c("INSTNM", "CITY", "STABBR", "PREDDEG", "HIGHDEG", "CONTROL", "REGION, RANKING")])
## converting to numeric takes care of NULL and PrivacySupressed values
suppressWarnings(scorecard[numeric_col_names] <- sapply(scorecard[numeric_col_names],as.numeric))
factor_col_names <- c("STABBR", "PREDDEG", "HIGHDEG", "CONTROL", "REGION", "RANKING")
scorecard[factor_col_names] <- lapply(scorecard[factor_col_names], as.factor)
levels(scorecard$PREDDEG) <- c("Not classified", "Certificate", "Associate", "Bachelor", "Graduate")
levels(scorecard$HIGHDEG) <- c("Non-Degree", "Certificate", "Associate", "Bachelor", "Graduate")
levels(scorecard$CONTROL) <- c("Public", "Private nonprofit", "Private for-profit")
levels(scorecard$REGION) <- c("U.S. Service Schools", "New England", "Mid East", "Great Lakes", "Plains", "Southeast", "Southwest", "Rocky Mountains", "Far West", "Outlying Areas")
#Create one column for net price for both public and private institutions
scorecard$NPT4 <- coalesce(scorecard$NPT4_PRIV, scorecard$NPT4_PUB)
states <- data.frame(state=as.factor(c("AK", "AL", "AR", "AZ", "CA", "CO", "CT", "DC", "DE", "FL", "GA","HI", "IA", "ID", "IL", "IN", "KS", "KY", "LA", "MA", "MD", "ME", "MI", "MN", "MO", "MS",  "MT", "NC", "ND", "NE", "NH", "NJ", "NM", "NV", "NY", "OH", "OK", "OR", "PA", "PR", "RI", "SC", "SD", "TN", "TX", "UT", "VA", "VT", "WA", "WI", "WV", "WY")), full=as.factor(c("alaska","alabama","arkansas","arizona","california","colorado", "connecticut","district of columbia","delaware","florida","georgia", "hawaii", "iowa","idaho", "illinois", "indiana", "kansas", "kentucky", "louisiana","massachusetts","maryland","maine","michigan","minnesota","missouri","mississippi","montana","north carolina","north dakota", "nebraska","new hampshire","new jersey", "new mexico","nevada", "new york","ohio","oklahoma","oregon","pennsylvania","puerto rico", "rhode island","south carolina","south dakota","tennessee","texas",  "utah",  "virginia", "vermont", "washington", "wisconsin", "west virginia", "wyoming")))
fouryear <- scorecard[scorecard$PREDDEG == "Bachelor",]
fouryear <- fouryear[ , !(names(fouryear) %in% c("NPT4_PUB", "NPT4_PRIV"))]
priv_forprof<-fouryear[!(fouryear$CONTROL=="Private for-profit"),]
summary(fouryear)
p <- ggplot(fouryear)
p + geom_bar(aes(x=reorder(CONTROL, CONTROL, function(x) length(x)))) + labs(x="State",title="4-year institution count by state") + theme_bw() + coord_flip()
p + geom_bar(aes(x=reorder(STABBR, STABBR, function(x) length(x)), fill=CONTROL)) + labs(x="State",title="4-year institution count by state") + theme_bw() + coord_flip()
p + geom_bar(aes(x=reorder(REGION, REGION, function(x) length(x)), fill=CONTROL)) + labs(x="Region",title="4-year institution count by Region") + coord_flip()
p + geom_boxplot(aes(x=CONTROL, y=UGDS)) + coord_cartesian(ylim=c(0,50000)) + labs(x="Control of Institution", y="Undergraduate Enrollement", title="Undergraduate Enrollment Across Different Instituion Controls")
p + geom_boxplot(aes(x=REGION, y=UGDS_WHITE)) + ylim(0,1) + labs(x="Region", y="Proportion of Enrolled White Students", title="Distribution of White Enrollement by Region") + coord_flip()
p + geom_boxplot(aes(x=REGION, y=UGDS_BLACK)) + ylim(0,1) + labs(x="Region", y="Proportion of Enrolled Black Students", title="Distribution of Black Enrollement by Region") + coord_flip()
p + geom_boxplot(aes(x=REGION, y=UGDS_HISP)) + ylim(0,1)  + labs(x="Region", y="Proportion of Enrolled Hispanic Students", title="Distribution of Hispanic Enrollement by Region") + coord_flip()
p + geom_boxplot(aes(x=REGION, y=UGDS_ASIAN)) + ylim(0,1)  + labs(x="Region", y="Proportion of Enrolled Asian Students", title="Distribution of Asian Enrollement by Region") + coord_flip()
#p + geom_boxplot(aes(x=REGION, y=UGDS_AIAN)) + ylim(0,1)  + labs(x="Region", y="Proportion of Enrolled American Indian/Alaska Native", title="Distribution of American Indian/Alaska Native Enrollement by Region") + coord_flip()
#p + geom_boxplot(aes(x=REGION, y=UGDS_AIAN)) + ylim(0,1)  + labs(x="Region", y="Proportion of Enrolled American Indian/Alaska Native", title="Distribution of American Indian/Alaska Native Enrollement by Region") + coord_flip()
#p + geom_boxplot(aes(x=REGION, y=UGDS_NHPI)) + ylim(0,1)  + labs(x="Region", y="Proportion of Enrolled Native Hawaiian/Pacific Islander", title="Distribution of Native Hawaiian/Pacific Islander Enrollement by Region") + coord_flip()
UGDS_BLACK_STATE <- fouryear %>% select(STABBR, UGDS_BLACK) %>% group_by(STABBR) %>% summarise_at(vars(UGDS_BLACK), list(name = mean), na.rm = TRUE)
UGDS_BLACK_STATE$region <- states$full[match(UGDS_BLACK_STATE$STABBR, states$state)]
states_black <- map_data("state")
map.df <- merge(states_black,UGDS_BLACK_STATE, by="region", all.x=T)
map.df <- map.df[order(map.df$order),]
map.df$blackpct <- map.df$name
ggplot(map.df, aes(x=long,y=lat,group=group)) + labs(x="", y="", title="Average Black Undergrad Percentage by State") + geom_polygon(aes(fill=blackpct)) + geom_path() + scale_fill_gradientn(colours=rev(heat.colors(10)),na.value="grey90") + coord_map() + theme_bw() + theme(axis.text.x = element_blank(), axis.ticks.x = element_blank(), axis.text.y = element_blank(), axis.ticks.y = element_blank())
p + geom_point(aes(x = SAT_AVG, y=ADM_RATE, color=CONTROL), alpha=0.7) + labs(x="Average SAT Score",y="Admit Rate", title="SAT Score vs Admit Rate") + geom_smooth(aes(x = SAT_AVG, y=ADM_RATE), method = "lm")
p + geom_point(aes(x=UG25ABV , y=PPTUG_EF, color=CONTROL)) + geom_smooth(aes(x = UG25ABV, y=PPTUG_EF), method = "lm") + labs(x="Percentage of students older than 25 yrs old", y="Percentage of part-time students", title = "Older students and Part Time Students")
p + geom_boxplot(aes(x=reorder(STABBR, COSTT4_A, na.rm = TRUE), y=NPT4))+ labs(x="State", y="Average Net Cost", title="Average Net Cost by State") + coord_flip()
p + geom_boxplot(aes(x=reorder(REGION, COSTT4_A, na.rm = TRUE), y=NPT4)) + labs(x="Region", y="Average Net Cost", title="Average Net Cost by Region") + coord_flip()
p + geom_boxplot(aes(x=reorder(STABBR, NPT4, na.rm = TRUE), y=NPT4))+ labs(x="State", y="Average Net Price", title="Average Net Price by State") + coord_flip()
p + geom_boxplot(aes(x=reorder(REGION, NPT4, na.rm = TRUE), y=NPT4)) + labs(x="Region", y="Average Net Price", title="Average Net Price by Region") + coord_flip()
COSTT4_A_STATE <- fouryear %>% select(STABBR, COSTT4_A) %>% group_by(STABBR) %>% summarise_at(vars(COSTT4_A), list(name = mean), na.rm = TRUE)
COSTT4_A_STATE$region <- states$full[match(COSTT4_A_STATE$STABBR, states$state)]
states_netprice <- map_data("state")
map.df <- merge(states_netprice, COSTT4_A_STATE, by="region", all.x=T)
map.df <- map.df[order(map.df$order),]
map.df$avg_netcost <- map.df$name
ggplot(map.df, aes(x=long,y=lat,group=group)) + labs(x="", y="", title="Average Net Cost by State") + geom_polygon(aes(fill=avg_netcost)) + geom_path() + scale_fill_gradientn(colours=rev(terrain.colors(8)),na.value="grey90") + coord_map() + theme_bw() + theme(axis.text.x = element_blank(), axis.ticks.x = element_blank(), axis.text.y = element_blank(), axis.ticks.y = element_blank())
NPT4_STATE <- fouryear %>% select(STABBR, NPT4) %>% group_by(STABBR) %>% summarise_at(vars(NPT4), list(name = mean), na.rm = TRUE)
NPT4_STATE$region <- states$full[match(NPT4_STATE$STABBR, states$state)]
states_netprice <- map_data("state")
map.df <- merge(states_netprice, NPT4_STATE, by="region", all.x=T)
map.df <- map.df[order(map.df$order),]
map.df$avg_netprice <- map.df$name
ggplot(map.df, aes(x=long,y=lat,group=group)) + labs(x="", y="", title="Average Net Price by State") + geom_polygon(aes(fill=avg_netprice)) + geom_path() + scale_fill_gradientn(colours=rev(terrain.colors(8)),na.value="grey90") + coord_map() + theme_bw() + theme(axis.text.x = element_blank(), axis.ticks.x = element_blank(), axis.text.y = element_blank(), axis.ticks.y = element_blank())
p + geom_point(aes(x =  COSTT4_A, y= NPT4, color=CONTROL), alpha=.4) + labs(x="Average Net Cost",y="Average Net Price", title="Average Net Cost vs Average Net Price")
p + geom_boxplot(aes(x=reorder(STABBR, AVGFACSAL, na.rm = TRUE), y=AVGFACSAL)) + labs(x="State", y="Average Faculty Salary", title="Average Faculty Monthly Salary by State") + coord_flip()
p + geom_boxplot(aes(x=reorder(REGION, AVGFACSAL, na.rm = TRUE), y=AVGFACSAL)) + labs(x="Region", y="Average Faculty Salary", title="Average Faculty Monthly Salary by Region") + coord_flip()
p + geom_point(aes(x = NPT4, y=AVGFACSAL, color=CONTROL), alpha=.4) + labs(x="Average Net Price",y="Average Faculty Monthly Salary", title="Average Net Price vs Average Faculty Monthly Salary ")
p + geom_point(aes(x = COSTT4_A, y=AVGFACSAL, color=CONTROL), alpha=.4) + labs(x="Average Cost of Attendance",y="Average Faculty Monthly Salary", title="Average Cost of Attendance vs Average Faculty Monthly Salary ")
p + geom_boxplot(aes(x=CONTROL, y=COSTT4_A)) + labs(x="Institution Control", y="Average Cost of Attendance", title = "Average Cost of Attendance by Control")
p + geom_boxplot(aes(x=CONTROL, y=NPT4)) + labs(x="Institution Control", y="Average Net Price", title = "Average Net Price by Control")
p + geom_boxplot(aes(x=CONTROL, y=AVGFACSAL)) + labs(x="Institution Control", y="Average Montly Faculty Salary", title = "Average Montly Faculty Salary by Control")
p + geom_point(aes(x = FIRST_GEN, y=PCTPELL, color=CONTROL)) + labs(x="Average Net Cost",y="Percentage of Pell Grant Undergrads", title="Net Cost vs Pell Grant Students") + geom_smooth(aes(x = COSTT4_A, y=PCTPELL), method = "lm")
p + geom_point(aes(x = FIRST_GEN, y=PCTPELL, color=CONTROL)) + labs(x="Average Net Cost",y="Percentage of Pell Grant Undergrads", title="Net Cost vs Pell Grant Students")
p + geom_point(aes(x = FIRST_GEN, y=PCTPELL, color=CONTROL)) + labs(x="Percentage of First-Gen Undergrads",y="Percentage of Pell Grant Undergrads", title="First Gen Students vs Pell Grant Students")
p + geom_point(aes(x = PCTPELL, y=PCTFLOAN, color=CONTROL)) + labs(x="Average Net Cost",y="Percentage of Federal Loan Recipients", title="Net Cost vs Federal Loan Recipient Students") + geom_smooth(aes(x = PCTPELL, y=PCTFLOAN), method = "lm")
p + geom_point(aes(x = TUITIONFEE_IN, y=TUITIONFEE_OUT, color=CONTROL)) + labs(x="In-state tuition and fees", y="Out-of-state tuition and fees", title="In-state vs Out-of-state tuition and fees")
p + geom_point(aes(x = TUITIONFEE_IN, y=TUITIONFEE_OUT, color=CONTROL)) + labs(x="In-state tuition and fees", y="Out-of-state tuition and fees", title="In-state vs Out-of-state tuition and fees")
p + geom_histogram(aes(x=C150_4)) + labs(x="150% Completion Rates", title="Distribution of Completion Rates")
p + geom_boxplot(aes(x=CONTROL, y=C150_4)) + labs(x="Institution Control", y="Completion Rates", title = "Completion Rates by Control")
p + geom_boxplot(aes(x=CONTROL, y=RET_FT4)) + labs(x="Institution Control", y="Retention Rates", title = "Retention Rates by Control")
p + geom_point(aes(x = RET_FT4, y=C150_4, color=CONTROL), alpha=0.7) + labs(x="Retention Rate for First-Time Students", y="Completion Rate for First-Time Students", title="Retention vs Completion Rates")
p + geom_point(aes(x = AVGFACSAL, y=C150_4, color=ADM_RATE), alpha=0.5) + scale_color_gradient(low="orange", high="blue") + labs(x="Average Faculty Monthly Salary",y="Completion Rates", title="Faculty Earnings vs Student Completion Rates")
p + geom_point(aes(x = ADM_RATE, y=C150_4, color=CONTROL), alpha=0.5) + labs(x="Admit Rate",y="Completion Rates", title="Admit Rate vs Student Completion Rates")
p + geom_point(aes(x = COSTT4_A, y=C150_4, color=CONTROL), alpha=0.5) + labs(x="Average Cost of Attendance",y="Completion Rates", title="Average Cost of Attendance vs Student Completion Rates")
p + geom_point(aes(x = NPT4, y=C150_4, color=CONTROL), alpha=0.5) + labs(x="Average Cost of Attendance",y="Completion Rates", title="Average Cost of Attendance vs Student Completion Rates")
p + geom_point(aes(x = COSTT4_A, y=C150_4, color=CONTROL), alpha=0.5) + labs(x="Average Cost of Attendance",y="Completion Rates", title="Average Cost of Attendance vs Student Completion Rates")
p + geom_point(aes(x = NPT4, y=MD_EARN_WNE_P10, color=CONTROL), alpha=0.7)  + labs(x="Average Net Price",y="Median Earnings after 10 years of Enrollment", title="Net Price vs Earnings") + geom_smooth(aes(x = NPT4, y=MD_EARN_WNE_P10), method = "lm")
p + geom_point(aes(x = C150_4, y=MD_EARN_WNE_P10, color=CONTROL), alpha=0.7)  + labs(x="Average Net Price",y="Median Earnings after 10 years of Enrollment", title="Net Price vs Earnings") + geom_smooth(aes(x = NPT4, y=MD_EARN_WNE_P10), method = "lm")
p + geom_point(aes(x = C150_4, y=MD_EARN_WNE_P10, color=CONTROL), alpha=0.7)  + labs(x="Average Net Price",y="Median Earnings after 10 years of Enrollment", title="Net Price vs Earnings")
p + geom_point(aes(x = COSTT4_A, y=MD_EARN_WNE_P10, color=CONTROL), alpha=0.7)  + labs(x="Average Net Price",y="Median Earnings after 10 years of Enrollment", title="Net Price vs Earnings")
p + geom_point(aes(x = COSTT4_A, y=MD_EARN_WNE_P10, color=CONTROL), alpha=0.7)  + labs(x="Average Net Price",y="Median Earnings after 10 years of Enrollment", title="Net Price vs Earnings")
p + geom_point(aes(x = COSTT4_A, y=MD_EARN_WNE_P10, color=CONTROL), alpha=0.7)  + labs(x="Average Net Cost",y="Median Earnings after 10 years of Enrollment", title="Net Cost vs Earnings")
p + geom_point(aes(x = AVGFACSAL, y=C150_4, color=ADM_RATE), alpha=0.7) + scale_color_gradient(low="orange", high="blue") + labs(x="Average Faculty Monthly Salary",y="Completion Rates", title="Faculty Earnings vs Student Completion Rates")
p + geom_point(aes(x = COSTT4_A, y=C150_4, color=CONTROL), alpha=0.5) + labs(x="Average Cost of Attendance",y="Completion Rates", title="Average Cost of Attendance vs Student Completion Rates")
p + geom_point(aes(x = FIRST_GEN, y=C150_4, color=CONTROL), alpha=0.5) + labs(x="Average Cost of Attendance",y="Completion Rates", title="Average Cost of Attendance vs Student Completion Rates")
fouryear[fouryear$FIRST_GEN.isna(), ]
fouryear[is.na(fouryear$FIRST_GEN), ]
summary(fouryear[is.na(fouryear$FIRST_GEN), ])
#na_firsgen <- fouryear[is.na(fouryear$FIRST_GEN), ]
#summary(na_firsgen)
p + geom_point(aes(x = FIRST_GEN, y=C150_4, color=CONTROL), alpha=0.5) + labs(x="Average Cost of Attendance",y="Completion Rates", title="Average Cost of Attendance vs Student Completion Rates")
#na_firsgen <- fouryear[is.na(fouryear$FIRST_GEN), ]
#summary(na_firsgen)
p + geom_point(aes(x = FIRST_GEN, y=C150_4, color=CONTROL), alpha=0.5) + labs(x="First-Gen Percentage",y="Completion Rates", title="First Generation Students vs Student Completion Rates")
#na_firsgen <- fouryear[is.na(fouryear$FIRST_GEN), ]
#summary(na_firsgen)
p + geom_point(aes(x = FIRST_GEN, y=C150_4, color=ADM_RT), alpha=0.5) + labs(x="First-Gen Percentage",y="Completion Rates", title="First Generation Students vs Student Completion Rates")
#na_firsgen <- fouryear[is.na(fouryear$FIRST_GEN), ]
#summary(na_firsgen)
p + geom_point(aes(x = FIRST_GEN, y=C150_4, color=ADM_RATE), alpha=0.5) + labs(x="First-Gen Percentage",y="Completion Rates", title="First Generation Students vs Student Completion Rates")
#na_firsgen <- fouryear[is.na(fouryear$FIRST_GEN), ]
#summary(na_firsgen)
p + geom_point(aes(x = FIRST_GEN, y=C150_4, color=CONTROL), alpha=0.5) + labs(x="First-Gen Percentage",y="Completion Rates", title="First Generation Students vs Student Completion Rates")
p + geom_point(aes(x = COSTT4_A, y=GRAD_DEBT_MDN, color=CONTROL), alpha=0.7)  + labs(x="Average Net Cost",y="Median Earnings after 10 years of Enrollment", title="Net Cost vs Earnings")
p + geom_boxplot(aes(x=CONTROL, y=GRAD_DEBT_MDN)) + labs(x="Institution Control", y="Median Debt", title = "Median Debt by Control")
na_debt <- fouryear[is.na(fouryear$GRAD_DEBT_MDN), ]
summary(na_debt)
na_debt <- fouryear[is.na(fouryear$GRAD_DEBT_MDN), ]
summary(na_debt)
p + geom_boxplot(aes(x=CONTROL, y=GRAD_DEBT_MDN)) + labs(x="Institution Control", y="Median Debt", title = "Median Debt by Control")
p + geom_point(aes(x = SAT_AVG, y=ADM_RATE, color=CONTROL), alpha=0.7) + labs(x="Average SAT Score",y="Admit Rate", title="SAT Score vs Admit Rate") + geom_smooth(aes(x = SAT_AVG, y=ADM_RATE), method = "lm", formula = y~x)
p + geom_point(aes(x = SAT_AVG, y=ADM_RATE, color=ADM_RATE), alpha=0.7) + labs(x="Average SAT Score",y="Admit Rate", title="SAT Score vs Admit Rate") + geom_smooth(aes(x = SAT_AVG, y=ADM_RATE), method = "lm", formula = y~x)
p + geom_point(aes(x = SAT_AVG, y=ADM_RATE, color=ADM_RATE), alpha=0.7) + scale_color_gradient(low="orange", high="blue") + labs(x="Average SAT Score",y="Admit Rate", title="SAT Score vs Admit Rate") + geom_smooth(aes(x = SAT_AVG, y=ADM_RATE), method = "lm", formula = y~x)
p + geom_point(aes(x = SAT_AVG, y=ADM_RATE, color=ADM_RATE), alpha=0.7) +  labs(x="Average SAT Score",y="Admit Rate", title="SAT Score vs Admit Rate") + geom_smooth(aes(x = SAT_AVG, y=ADM_RATE), method = "lm", formula = y~x)
p + geom_point(aes(x = SAT_AVG, y=ADM_RATE, color=CONTROL), alpha=0.7) + labs(x="Average SAT Score",y="Admit Rate", title="SAT Score vs Admit Rate") + geom_smooth(aes(x = SAT_AVG, y=ADM_RATE), method = "lm", formula = y~x)
View(fouryear)
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
library(readr)
library(tidyr)
library(gridExtra)
library(tufte)
library(readxl)
library(dplyr)
library(reshape2)
library(gghighlight)
library(DBI)
library(maps)
library(mapproj)
scorecard <- read_excel("selectedvar_1314.xlsx")
summary(scorecard)
# CLEAN Data: convert to appropriate type, name categorical variables
# Convert to appropriate type
numeric_col_names <- colnames(scorecard[, !names(scorecard) %in% c("INSTNM", "CITY", "STABBR", "PREDDEG", "HIGHDEG", "CONTROL", "REGION, RANKING")])
## converting to numeric takes care of NULL and PrivacySupressed values
suppressWarnings(scorecard[numeric_col_names] <- sapply(scorecard[numeric_col_names],as.numeric))
factor_col_names <- c("STABBR", "PREDDEG", "HIGHDEG", "CONTROL", "REGION", "RANKING")
scorecard[factor_col_names] <- lapply(scorecard[factor_col_names], as.factor)
levels(scorecard$PREDDEG) <- c("Not classified", "Certificate", "Associate", "Bachelor", "Graduate")
levels(scorecard$HIGHDEG) <- c("Non-Degree", "Certificate", "Associate", "Bachelor", "Graduate")
levels(scorecard$CONTROL) <- c("Public", "Private nonprofit", "Private for-profit")
levels(scorecard$REGION) <- c("U.S. Service Schools", "New England", "Mid East", "Great Lakes", "Plains", "Southeast", "Southwest", "Rocky Mountains", "Far West", "Outlying Areas")
#Create one column for net price for both public and private institutions
scorecard$NPT4 <- coalesce(scorecard$NPT4_PRIV, scorecard$NPT4_PUB)
states <- data.frame(state=as.factor(c("AK", "AL", "AR", "AZ", "CA", "CO", "CT", "DC", "DE", "FL", "GA","HI", "IA", "ID", "IL", "IN", "KS", "KY", "LA", "MA", "MD", "ME", "MI", "MN", "MO", "MS",  "MT", "NC", "ND", "NE", "NH", "NJ", "NM", "NV", "NY", "OH", "OK", "OR", "PA", "PR", "RI", "SC", "SD", "TN", "TX", "UT", "VA", "VT", "WA", "WI", "WV", "WY")), full=as.factor(c("alaska","alabama","arkansas","arizona","california","colorado", "connecticut","district of columbia","delaware","florida","georgia", "hawaii", "iowa","idaho", "illinois", "indiana", "kansas", "kentucky", "louisiana","massachusetts","maryland","maine","michigan","minnesota","missouri","mississippi","montana","north carolina","north dakota", "nebraska","new hampshire","new jersey", "new mexico","nevada", "new york","ohio","oklahoma","oregon","pennsylvania","puerto rico", "rhode island","south carolina","south dakota","tennessee","texas",  "utah",  "virginia", "vermont", "washington", "wisconsin", "west virginia", "wyoming")))
fouryear <- scorecard[scorecard$PREDDEG == "Bachelor",]
fouryear <- fouryear[ , !(names(fouryear) %in% c("NPT4_PUB", "NPT4_PRIV"))]
priv_forprof<-fouryear[!(fouryear$CONTROL=="Private for-profit"),]
summary(fouryear)
p <- ggplot(fouryear)
p + geom_bar(aes(x=reorder(CONTROL, CONTROL, function(x) length(x)))) + labs(x="State",title="4-year institution count by state") + theme_bw() + coord_flip()
p + geom_bar(aes(x=reorder(STABBR, STABBR, function(x) length(x)), fill=CONTROL)) + labs(x="State",title="4-year institution count by state") + theme_bw() + coord_flip()
p + geom_bar(aes(x=reorder(REGION, REGION, function(x) length(x)), fill=CONTROL)) + labs(x="Region",title="4-year institution count by Region") + coord_flip()
p + geom_boxplot(aes(x=CONTROL, y=UGDS)) + coord_cartesian(ylim=c(0,50000)) + labs(x="Control of Institution", y="Undergraduate Enrollement", title="Undergraduate Enrollment Across Different Instituion Controls")
p + geom_boxplot(aes(x=REGION, y=UGDS_WHITE)) + ylim(0,1) + labs(x="Region", y="Proportion of Enrolled White Students", title="Distribution of White Enrollement by Region") + coord_flip()
p + geom_boxplot(aes(x=REGION, y=UGDS_BLACK)) + ylim(0,1) + labs(x="Region", y="Proportion of Enrolled Black Students", title="Distribution of Black Enrollement by Region") + coord_flip()
p + geom_boxplot(aes(x=REGION, y=UGDS_HISP)) + ylim(0,1)  + labs(x="Region", y="Proportion of Enrolled Hispanic Students", title="Distribution of Hispanic Enrollement by Region") + coord_flip()
p + geom_boxplot(aes(x=REGION, y=UGDS_ASIAN)) + ylim(0,1)  + labs(x="Region", y="Proportion of Enrolled Asian Students", title="Distribution of Asian Enrollement by Region") + coord_flip()
#p + geom_boxplot(aes(x=REGION, y=UGDS_AIAN)) + ylim(0,1)  + labs(x="Region", y="Proportion of Enrolled American Indian/Alaska Native", title="Distribution of American Indian/Alaska Native Enrollement by Region") + coord_flip()
#p + geom_boxplot(aes(x=REGION, y=UGDS_AIAN)) + ylim(0,1)  + labs(x="Region", y="Proportion of Enrolled American Indian/Alaska Native", title="Distribution of American Indian/Alaska Native Enrollement by Region") + coord_flip()
#p + geom_boxplot(aes(x=REGION, y=UGDS_NHPI)) + ylim(0,1)  + labs(x="Region", y="Proportion of Enrolled Native Hawaiian/Pacific Islander", title="Distribution of Native Hawaiian/Pacific Islander Enrollement by Region") + coord_flip()
UGDS_BLACK_STATE <- fouryear %>% select(STABBR, UGDS_BLACK) %>% group_by(STABBR) %>% summarise_at(vars(UGDS_BLACK), list(name = mean), na.rm = TRUE)
UGDS_BLACK_STATE$region <- states$full[match(UGDS_BLACK_STATE$STABBR, states$state)]
states_black <- map_data("state")
map.df <- merge(states_black,UGDS_BLACK_STATE, by="region", all.x=T)
map.df <- map.df[order(map.df$order),]
map.df$blackpct <- map.df$name
ggplot(map.df, aes(x=long,y=lat,group=group)) + labs(x="", y="", title="Average Black Undergrad Percentage by State") + geom_polygon(aes(fill=blackpct)) + geom_path() + scale_fill_gradientn(colours=rev(heat.colors(10)),na.value="grey90") + coord_map() + theme_bw() + theme(axis.text.x = element_blank(), axis.ticks.x = element_blank(), axis.text.y = element_blank(), axis.ticks.y = element_blank())
p + geom_point(aes(x = SAT_AVG, y=ADM_RATE, color=CONTROL), alpha=0.7) + labs(x="Average SAT Score",y="Admit Rate", title="SAT Score vs Admit Rate") + geom_smooth(aes(x = SAT_AVG, y=ADM_RATE), method = "lm", formula = y~x)
View(fouryear)
p + geom_point(aes(x = FAMINC, y=SAT_AVG, color=CONTROL), alpha=0.7) + labs(x="Average SAT Score",y="Admit Rate", title="SAT Score vs Admit Rate") + geom_smooth(aes(x = SAT_AVG, y=ADM_RATE), method = "lm", formula = y~x)
p + geom_point(aes(x = FAMINC, y=C150_4, color=CONTROL), alpha=0.7) + labs(x="Average SAT Score",y="Admit Rate", title="SAT Score vs Admit Rate") + geom_smooth(aes(x = SAT_AVG, y=ADM_RATE), method = "lm", formula = y~x)
p + geom_point(aes(x = FAMINC, y=C150_4, color=CONTROL), alpha=0.7) + labs(x="Average SAT Score",y="Admit Rate", title="SAT Score vs Admit Rate")
p + geom_point(aes(x = FAMINC, y=C150_4, color=CONTROL), alpha=0.7) + labs(x="Average SAT Score",y="Admit Rate", title="SAT Score vs Admit Rate")
p + geom_point(aes(x = FAMINC, y=C150_4, color=CONTROL), alpha=0.7) + labs(x="Average Family Income",y="Completion Rate", title="Family Income vs Completion Rate")
p + geom_point(aes(x = FAMINC, y=C150_4, color=CONTROL), alpha=0.7) + labs(x="Average Family Income",y="Completion Rate", title="Family Income vs Completion Rate") + + gghighlight(!is.na(RANKING))
p + geom_point(aes(x = FAMINC, y=C150_4, color=CONTROL), alpha=0.7) + labs(x="Average Family Income",y="Completion Rate", title="Family Income vs Completion Rate") + gghighlight(!is.na(RANKING))
p + geom_point(aes(x = FAMINC, y=C150_4, color=CONTROL), alpha=0.7) + labs(x="Average Family Income",y="Completion Rate", title="Family Income vs Completion Rate")
p + geom_point(aes(x = C150_4, y=MD_EARN_WNE_P10, color=CONTROL))  + labs(x="Completion Rates", y="Median Earnings after 10 years of Enrollment", title="Completion vs Median Earnings") + geom_smooth(aes(x = C150_4, y=MD_EARN_WNE_P10), method = "lm") + gghighlight(!is.na(RANKING))
p + geom_point(aes(x = C150_4, y=MD_EARN_WNE_P10, color=CONTROL))  + labs(x="Completion Rates", y="Median Earnings after 10 years of Enrollment", title="Completion vs Median Earnings") + geom_smooth(aes(x = C150_4, y=MD_EARN_WNE_P10), method = "lm")
p + geom_point(aes(x = C150_4, y=MD_EARN_WNE_P10, color=CONTROL))  + labs(x="Completion Rates", y="Median Earnings after 10 years of Enrollment", title="Completion vs Median Earnings") + geom_smooth(aes(x = C150_4, y=MD_EARN_WNE_P10), method = "lm")
p + geom_bar(aes(x=reorder(REGION, REGION, function(x) length(x)), fill=CONTROL)) + labs(x="Region",title="4-year institution count by Region") + theme_bw() + coord_flip()
p + geom_boxplot(aes(x=CONTROL, y=UGDS)) + coord_cartesian(ylim=c(0,50000)) + labs(x="Control of Institution", y="Undergraduate Enrollement", title="Undergraduate Enrollment Across Different Instituion Controls") + theme_bw()
p + geom_boxplot(aes(x=REGION, y=UGDS_WHITE)) + ylim(0,1) + labs(x="Region", y="Proportion of Enrolled White Students", title="Distribution of White Enrollement by Region") + coord_flip() + theme_bw()
p + geom_boxplot(aes(x=REGION, y=UGDS_BLACK)) + ylim(0,1) + labs(x="Region", y="Proportion of Enrolled Black Students", title="Distribution of Black Enrollement by Region") + coord_flip() + theme_bw()
p + geom_boxplot(aes(x=REGION, y=UGDS_HISP)) + ylim(0,1)  + labs(x="Region", y="Proportion of Enrolled Hispanic Students", title="Distribution of Hispanic Enrollement by Region") + coord_flip() + theme_bw()
p + geom_boxplot(aes(x=REGION, y=UGDS_ASIAN)) + ylim(0,1)  + labs(x="Region", y="Proportion of Enrolled Asian Students", title="Distribution of Asian Enrollement by Region") + coord_flip() + theme_bw()
#p + geom_boxplot(aes(x=REGION, y=UGDS_AIAN)) + ylim(0,1)  + labs(x="Region", y="Proportion of Enrolled American Indian/Alaska Native", title="Distribution of American Indian/Alaska Native Enrollement by Region") + coord_flip()
#p + geom_boxplot(aes(x=REGION, y=UGDS_AIAN)) + ylim(0,1)  + labs(x="Region", y="Proportion of Enrolled American Indian/Alaska Native", title="Distribution of American Indian/Alaska Native Enrollement by Region") + coord_flip()
#p + geom_boxplot(aes(x=REGION, y=UGDS_NHPI)) + ylim(0,1)  + labs(x="Region", y="Proportion of Enrolled Native Hawaiian/Pacific Islander", title="Distribution of Native Hawaiian/Pacific Islander Enrollement by Region") + coord_flip()
UGDS_BLACK_STATE <- fouryear %>% select(STABBR, UGDS_BLACK) %>% group_by(STABBR) %>% summarise_at(vars(UGDS_BLACK), list(name = mean), na.rm = TRUE)
UGDS_BLACK_STATE$region <- states$full[match(UGDS_BLACK_STATE$STABBR, states$state)]
states_black <- map_data("state")
map.df <- merge(states_black,UGDS_BLACK_STATE, by="region", all.x=T)
map.df <- map.df[order(map.df$order),]
map.df$blackpct <- map.df$name
ggplot(map.df, aes(x=long,y=lat,group=group)) + labs(x="", y="", title="Average Black Undergrad Percentage by State") + geom_polygon(aes(fill=blackpct)) + geom_path() + scale_fill_gradientn(colours=rev(heat.colors(10)),na.value="grey90") + coord_map() + theme_bw() + theme(axis.text.x = element_blank(), axis.ticks.x = element_blank(), axis.text.y = element_blank(), axis.ticks.y = element_blank())
p + geom_point(aes(x=UG25ABV , y=PPTUG_EF, color=CONTROL)) + geom_smooth(aes(x = UG25ABV, y=PPTUG_EF), method = "lm") + labs(x="Percentage of students older than 25 yrs old", y="Percentage of part-time students", title = "Older students and Part Time Students")
p + geom_point(aes(x=UG25ABV , y=PPTUG_EF, color=CONTROL)) + geom_smooth(aes(x = UG25ABV, y=PPTUG_EF), method = "lm") + labs(x="Percentage of students older than 25 yrs old", y="Percentage of part-time students", title = "Older students and Part Time Students")
p + geom_boxplot(aes(x=reorder(STABBR, COSTT4_A, na.rm = TRUE), y=NPT4))+ labs(x="State", y="Average Net Cost", title="Average Net Cost by State") + coord_flip()
p + geom_boxplot(aes(x=reorder(REGION, COSTT4_A, na.rm = TRUE), y=NPT4)) + labs(x="Region", y="Average Net Cost", title="Average Net Cost by Region") + coord_flip()
p + geom_boxplot(aes(x=reorder(STABBR, NPT4, na.rm = TRUE), y=NPT4))+ labs(x="State", y="Average Net Price", title="Average Net Price by State") + coord_flip()
p + geom_boxplot(aes(x=reorder(REGION, NPT4, na.rm = TRUE), y=NPT4)) + labs(x="Region", y="Average Net Price", title="Average Net Price by Region") + coord_flip()
p + geom_boxplot(aes(x=reorder(STABBR, AVGFACSAL, na.rm = TRUE), y=AVGFACSAL)) + labs(x="State", y="Average Faculty Salary", title="Average Faculty Monthly Salary by State") + coord_flip()
p + geom_boxplot(aes(x=reorder(REGION, AVGFACSAL, na.rm = TRUE), y=AVGFACSAL)) + labs(x="Region", y="Average Faculty Salary", title="Average Faculty Monthly Salary by Region") + coord_flip()
p + geom_boxplot(aes(x=CONTROL, y=COSTT4_A)) + labs(x="Institution Control", y="Average Cost of Attendance", title = "Average Cost of Attendance by Control")
p + geom_boxplot(aes(x=CONTROL, y=AVGFACSAL)) + labs(x="Institution Control", y="Average Montly Faculty Salary", title = "Average Montly Faculty Salary by Control")
p + geom_boxplot(aes(x=CONTROL, y=NPT4)) + labs(x="Institution Control", y="Average Net Price", title = "Average Net Price by Control")
p + geom_boxplot(aes(x=CONTROL, y=AVGFACSAL)) + labs(x="Institution Control", y="Average Montly Faculty Salary", title = "Average Montly Faculty Salary by Control")
p + geom_point(aes(x = PPTUG_EF, y=C150_4, color=CONTROL), alpha=0.5) + labs(x="Average Cost of Attendance",y="Completion Rates", title="Average Cost of Attendance vs Student Completion Rates")
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
library(readr)
library(tidyr)
library(gridExtra)
library(tufte)
library(readxl)
library(dplyr)
library(reshape2)
library(gghighlight)
library(DBI)
library(maps)
library(mapproj)
library(usmap)
library(tibble)
library(betareg)
library(cvTools)
scorecard <- read_excel("selectedvar_1314.xlsx")
summary(scorecard)
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
library(readr)
library(tidyr)
library(gridExtra)
library(tufte)
library(readxl)
library(dplyr)
library(reshape2)
library(gghighlight)
library(DBI)
library(maps)
library(mapproj)
library(usmap)
library(tibble)
library(betareg)
library(cvTools)
# CLEAN Data: convert to appropriate type, name categorical variables
# Convert to appropriate type
scorecard$HBCU <- ifelse(is.na(scorecard$HBCU), 0, scorecard$HBCU)
numeric_col_names <- colnames(scorecard[, !names(scorecard) %in% c("INSTNM", "CITY", "STABBR", "PREDDEG", "HIGHDEG", "CONTROL", "REGION, RANKING", "HBCU", "DISTANCEONLY")])
## converting to numeric takes care of NULL and PrivacySupressed values
suppressWarnings(scorecard[numeric_col_names] <- sapply(scorecard[numeric_col_names],as.numeric))
factor_col_names <- c("STABBR", "PREDDEG", "HIGHDEG", "CONTROL", "REGION", "RANKING", "HBCU", "DISTANCEONLY")
scorecard[factor_col_names] <- lapply(scorecard[factor_col_names], as.factor)
levels(scorecard$PREDDEG) <- c("Not classified", "Certificate", "Associate", "Bachelor", "Graduate")
levels(scorecard$HIGHDEG) <- c("Non-Degree", "Certificate", "Associate", "Bachelor", "Graduate")
levels(scorecard$CONTROL) <- c("Public", "Private nonprofit", "Private for-profit")
levels(scorecard$REGION) <- c("U.S. Service Schools", "New England", "Mid East", "Great Lakes", "Plains", "Southeast", "Southwest", "Rocky Mountains", "Far West", "Outlying Areas")
#Create one column for net price for both public and private institutions
scorecard$NPT4 <- coalesce(scorecard$NPT4_PRIV, scorecard$NPT4_PUB)
fouryear <- scorecard %>% filter(PREDDEG == "Bachelor") %>% filter(DISTANCEONLY == 0) %>% filter(!grepl("Online", INSTNM)) %>% filter(!grepl("Graduate", INSTNM))
fouryear <- fouryear[ , !(names(fouryear) %in% c("NPT4_PUB", "NPT4_PRIV"))]
fouryears <- fouryear #later to build model
fouryear <- scorecard %>% filter(PREDDEG == "Bachelor") %>% filter(DISTANCEONLY == 0) %>% filter(!grepl("Online", INSTNM)) %>% filter(!grepl("Graduate", INSTNM))
fouryear <- fouryear[ , !(names(fouryear) %in% c("NPT4_PUB", "NPT4_PRIV"))]
fouryears <- fouryear #later to build model
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
library(readr)
library(tidyr)
library(gridExtra)
library(tufte)
library(readxl)
library(dplyr)
library(reshape2)
library(gghighlight)
library(DBI)
library(maps)
library(mapproj)
library(usmap)
library(tibble)
library(betareg)
library(cvTools)
scorecard <- read_excel("selectedvar_1314.xlsx")
summary(scorecard)
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
library(readr)
library(tidyr)
library(gridExtra)
library(tufte)
library(readxl)
library(dplyr)
library(reshape2)
library(gghighlight)
library(DBI)
library(maps)
library(mapproj)
library(usmap)
library(tibble)
library(betareg)
library(cvTools)
scorecard <- read_excel("selectedvar_1314.xlsx")
summary(scorecard)
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
library(usmap)
library(readxl)
library(tidyr)
library(cvTools)
library(broom)
library(knitr)
library(tufte)
library(kableExtra)
dictionary <- read_excel("DataDictionary_Markdown.xlsx")
#knitr::opts_chunk$set(tidy = FALSE, cache.extra = packageVersion('tufte'),
#kable.force.latex = TRUE)
dictionary <- read_excel("DataDictionary_Markdown.xlsx")
dictionary
#kable(dictionary, table.envir='table*') %>% kable_styling(latex_options = c("hold_position"), full_width=T)
kable(dictionary) %>% kable_styling(full_width = TRUE)
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
library(usmap)
library(readxl)
library(tidyr)
library(cvTools)
library(broom)
library(knitr)
library(tufte)
p + geom_boxplot(aes(x=CONTROL, y=UGDS)) + coord_cartesian(ylim=c(0,50000)) + labs(x="Control of Institution", y="Undergraduate Enrollement", title="Undergraduate Enrollment Across Different Instituion Controls") + theme_bw()
summary(fouryears)
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
library(usmap)
library(readxl)
library(tidyr)
library(cvTools)
library(broom)
library(knitr)
library(tufte)
scorecard <- read_excel("selectedvar_1314.xlsx")
summary(scorecard)
# CLEAN Data: convert to appropriate type, name categorical variables
# Convert to appropriate type
scorecard$HBCU <- ifelse(is.na(scorecard$HBCU), 0, scorecard$HBCU)
numeric_col_names <- colnames(scorecard[, !names(scorecard) %in% c("INSTNM", "CITY", "STABBR", "PREDDEG", "HIGHDEG", "CONTROL", "REGION", "HBCU", "DISTANCEONLY")])
## converting to numeric takes care of NULL and PrivacySupressed values
scorecard[numeric_col_names] <- sapply(scorecard[numeric_col_names],as.numeric)
factor_col_names <- c("STABBR", "PREDDEG", "HIGHDEG", "CONTROL", "REGION", "HBCU", "DISTANCEONLY")
scorecard[factor_col_names] <- lapply(scorecard[factor_col_names], as.factor)
levels(scorecard$PREDDEG) <- c("Not classified", "Certificate", "Associate", "Bachelor", "Graduate")
levels(scorecard$HIGHDEG) <- c("Non-Degree", "Certificate", "Associate", "Bachelor", "Graduate")
levels(scorecard$CONTROL) <- c("Public", "Private nonprofit", "Private for-profit")
levels(scorecard$REGION) <- c("U.S. Service Schools", "New England", "Mid East", "Great Lakes", "Plains", "Southeast", "Southwest", "Rocky Mountains", "Far West", "Outlying Areas")
#Create one column for net price for both public and private institutions
scorecard$NPT4 <- coalesce(scorecard$NPT4_PRIV, scorecard$NPT4_PUB)
fouryear <- scorecard %>% filter(PREDDEG == "Bachelor") %>% filter(DISTANCEONLY == 0) %>% filter(!grepl("Online", INSTNM)) %>% filter(!grepl("Graduate", INSTNM))
fouryear <- fouryear[ , !(names(fouryear) %in% c("NPT4_PUB", "NPT4_PRIV"))]
fouryears <- fouryear #later to build model
p <- ggplot(fouryear)
p + geom_bar(aes(x=reorder(STABBR, STABBR, function(x) length(x)), fill=CONTROL)) + labs(x="State",title="4-year institution count by state", fill = "Control") + theme_bw() + coord_flip() + theme(axis.text.y = element_text(size = 12), legend.position = "bottom", legend.box = "horizontal")
reg <- data.frame(Region=c("U.S. Service Schools", "New England", "Mid East", "Great Lakes", "Plains", "Southeast", "Southwest", "Rocky Mountains", "Far West", "Outlying Areas"), stringsAsFactors = TRUE)
#Create a custom color scale
library(RColorBrewer)
myColors <- brewer.pal(10,"Set3")
names(myColors) <- levels(reg$Region)
colScale <- scale_colour_manual(name = "Region", values = myColors)
fillScale <- scale_fill_manual(name = "Region",values = myColors)
regions <- read_excel("regions.xlsx")
regions$fips <- fips(regions$State)
#regions_key <- plot_usmap(data=regions, values="Region") + labs(title = "Regions Key") +  theme(legend.position = "bottom", legend.box = "horizontal", legend.key.size = unit(.2, "cm"), axis.ticks = element_blank(), axis.line = element_blank(), plot.margin = margin(0,0,0,0,"pt"), axis.ticks.length = unit(0, "pt"), axis.text = element_blank()) + fillScale
plot_usmap(data=regions, values="Region") + labs(title = "Regions Key") +  theme(legend.position = "bottom", legend.box = "horizontal", plot.margin = unit(c(0, 6, 0, 0), "cm"), title=element_text(size=20), legend.title=element_text(size=15), legend.text=element_text(size=10)) + fillScale + guides(fill=guide_legend(nrow=2, byrow=TRUE))
#ggsave("regions_key.png")
#knitr::include_graphics('regions_key.png')
p + geom_bar(aes(x=reorder(REGION, REGION, function(x) length(x)), fill=CONTROL)) + labs(x="Region",title="4-year institution count by Region", fill = "Control") + theme_bw() + coord_flip() + theme(axis.text.y = element_text(size = 8), legend.position = "bottom", legend.box = "horizontal")
fouryear_c <- fouryear %>% filter(C150_4 != 0)  %>% filter(C150_4 != 1) %>% filter(RET_FT4 != 0)  %>% filter(RET_FT4 != 1)
pp <- ggplot(fouryear_c)
pp + geom_histogram(aes(x=C150_4), bins = 30) + geom_vline(xintercept = mean(fouryear_c$C150_4), color="green") + geom_vline(xintercept = mean(fouryear_c$C150_4), color="green") + labs(x="Completion Rate", title="Distribution of 150% Completion Rates at 4-year Institutions") + theme_bw() + theme(title=element_text(size=6))
pp + geom_boxplot(aes(x=CONTROL, y=C150_4)) + labs(x="Institution Control", y="Completion Rates", title = "Completion Rates by Control") + theme_bw()
pp + geom_boxplot(aes(x=reorder(REGION, C150_4, na.rm = TRUE), y=C150_4, fill=REGION)) + labs(x="Region", y="Completion Rate", title="Completion Rate by Region") + coord_flip() + theme_bw() + theme(legend.position="none") + fillScale
completion_us <- fouryear %>% select(STABBR, C150_4) %>% group_by(STABBR) %>% summarise_at(vars(C150_4), list(name = mean), na.rm = TRUE)
completion_us$fips <- fips(completion_us$STABBR)
completion_map <- plot_usmap(data=completion_us, values="name") + labs(title = "Average Completion Rate by State") + theme(panel.background=element_blank()) + scale_fill_gradient(low = "white", high = "deepskyblue4", na.value="grey90", name="Completion Rate") + theme(legend.position = "bottom", legend.box = "horizontal", plot.margin = unit(c(0, 6, 0, 0), "cm"), title=element_text(size=20), legend.title=element_text(size=15))
completion_map
pp + geom_point(aes(x = RET_FT4, y=C150_4, color=CONTROL), alpha=0.4) + labs(x="Retention Rate for First-Time Students", y="Completion Rate for First-Time Students", title="Retention vs Completion Rates", color="Control") + theme_bw() + theme(legend.position = "bottom", legend.box = "horizontal")
p + geom_boxplot(aes(x=CONTROL, y=RET_FT4)) + labs(x="Institution Control", y="Retention Rates", title = "Retention Rates by Control") + theme_bw()
pp + geom_point(aes(x = COSTT4_A, y=C150_4, color=CONTROL), alpha=0.5) + labs(x="Average Cost of Attendance",y="Completion Rates", title="Average Cost of Attendance vs Student Completion Rates") + theme_bw() + facet_grid(rows = vars(CONTROL)) + theme(legend.position = "bottom", legend.box = "horizontal")
p + geom_boxplot(aes(x=CONTROL, y=COSTT4_A)) + labs(x="Institution Control", y="Average Cost", title = "Average Cost by Control") + theme_bw()
pp + geom_point(aes(x = AVGFACSAL, y=C150_4, color=ADM_RATE), alpha=0.7) + scale_color_gradient(low="orange", high="blue") + labs(x="Average Faculty Monthly Salary",y="Completion Rates", title="Faculty Earnings vs Student Completion Rates") + theme_bw() + theme(legend.position = "bottom", legend.box = "horizontal")
pp + geom_point(aes(x = FIRST_GEN, y=C150_4, color=ADM_RATE), alpha=0.7) + scale_color_gradient(low="orange", high="blue") + labs(x="First-Gen Percentage",y="Completion Rates", title="First Generation Students vs Student Completion Rates") + theme_bw() + theme(legend.position = "bottom", legend.box = "horizontal")
pp + geom_point(aes(x = FAMINC, y=C150_4, color=CONTROL, fig.width=7, fig.height=4), alpha=0.5) + labs(x="Average Family Income",y="Completion Rate", title="Family Income vs Completion Rate") + theme_bw() + theme(legend.position = "bottom", legend.box = "horizontal")
pp + geom_point(aes(x = PPTUG_EF, y=C150_4, color=CONTROL), alpha=0.5) + geom_smooth(aes(x = PPTUG_EF, y=C150_4), method = "lm") + labs(x="Percentage of Part Time",y="Completion Rates", title="Part time vs Student Completion Rates") + theme_bw() + theme(legend.position = "bottom", legend.box = "horizontal")
results <- matrix(c(0.7703, 0.09651885,
0.7707, 0.09473868,
0.7707, 0.09461417,
0.7896, 0.09274086,
0.7707, 0.09473868,
0.7896, 0.09181058), ncol=2, byrow=TRUE)
colnames(results) <- c('Adjusted R-Squared','10-fold Cross Validation')
rownames(results) <- c('Full Model','Full Model Forward','Full Model Backward', 'Full Model w/ Interaction', 'Full Model w/ Interaction Forward','Full Model w/ Interaction Backward')
kable(results)
set.seed(3)
in.build = sample(nrow(full), size = round(nrow(full) * .50))
full <- fouryears %>% filter(!is.na(C150_4))
full <- full %>% filter(INSTNM != c("American University of Health Sciences")) %>% select(-c(MD_EARN_WNE_P10, GT_25K_P6, SAT_AVG, ACTCMMID, GRAD_DEBT_MDN, ADM_RATE, CITY, STABBR, PREDDEG, HIGHDEG, UGDS_2MOR, UGDS_NRA, UGDS_UNKN, DISTANCEONLY, ENDOWBEGIN, TUITIONFEE_OUT)) %>% filter(!is.na(FIRST_GEN)) %>% filter(C150_4 != 0) %>% filter(C150_4 != 1) %>% filter(RET_FT4 != 0) %>% filter(RET_FT4 != 1)  %>% drop_na() %>% filter(UGDS < 166816)
full$REGION <- droplevels(full$REGION)
summary(full)
set.seed(3)
in.build = sample(nrow(full), size = round(nrow(full) * .50))
build_n = full[in.build, ]
assess_n = full[-in.build, ]
build <- build_n %>% select(-c(INSTNM))
assess <- assess_n %>% select(-c(INSTNM))
set.seed(5)
model = lm(C150_4 ~ ., data = build)
summary(model)
cvFit(model, data=build, y=build$C150_4, K = 10)
plot(model)
plot(model$fitted.values, build$C150_4)
abline(coef = c(0,1))
set.seed(5)
fm.lower = lm(C150_4 ~ 1, data = build)
fm.upper = lm(C150_4 ~ ., data = build)
forward <- step(fm.lower, scope = formula(fm.upper), direction = "forward", trace=FALSE)
summary(forward)
cvFit(forward, data=build, y=build$C150_4, K = 10)
plot(forward)
plot(forward$fitted.values, build$C150_4)
set.seed(5)
fm.lower = lm(C150_4 ~ 1, data = build)
fm.upper = lm(C150_4 ~ ., data = build)
forward <- step(fm.lower, scope = formula(fm.upper), direction = "forward", trace=FALSE)
summary(forward)
cvFit(forward, data=build, y=build$C150_4, K = 10)
plot(forward)
plot(forward$fitted.values, build$C150_4)
set.seed(5)
backward <- step(fm.upper, scope = formula(fm.upper), direction = "backward", trace=FALSE)
summary(backward)
cvFit(backward, data=build, y=build$C150_4, K = 10)
plot(backward)
plot(backward$fitted.values, build$C150_4)
